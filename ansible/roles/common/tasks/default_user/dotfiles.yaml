---
- name: Install apt stow zsh
  apt:
    name:
      - stow
      - zsh
    state: latest
    install_recommends: no
    update_cache: yes

- name: Delete dotfiles repo if exist
  file:
    path: "{{ default_user_dotfiles_path }}"
    state: absent

- name: Clone dotfiles repo to default user
  become: yes
  become_user: "{{ default_user }}"
  git:
    repo: https://github.com/rhoriguchi/dotfiles.git
    dest: "{{ default_user_dotfiles_path }}"

- name: Change permissions for init.sh for dotfiles
  file:
    path: "{{ default_user_dotfiles_path }}/init.sh"
    mode: +x
    owner: "{{ default_user }}"

- name: Execute init.sh for dotfiles
  become: yes
  become_user: "{{ default_user }}"
  command: "sh {{ default_user_dotfiles_path }}/init.sh"

- name: Create .git-credentials file
  become: yes
  become_user: "{{ default_user }}"
  lineinfile:
    create: yes
    path: "{{ default_user_home }}/.git-credentials"
    line: "https://{{ vault_git_user }}:{{ vault_git_password }}@github.com"
  no_log: true
